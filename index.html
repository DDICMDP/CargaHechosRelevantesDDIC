<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hechos Relevantes</title>
  <link rel="stylesheet" href="assets/styles.css?v=10"/>
  <link rel="stylesheet" href="assets/tabs.css?v=10"/>
</head>
<body>
  <header class="hero">
    <div class="hero-inner">
      <h1>Hechos Relevantes</h1>
      <p class="tagline">WhatsApp + Word (Arial 12) + CSV • Múltiples casos • Catálogos editables</p>
    </div>
  </header>

  <main class="wrap">
    <div id="errorBox" class="alert" hidden></div>

    <!-- Casos guardados -->
    <section class="card">
      <h2>0) Hechos guardados</h2>
      <div class="grid">
        <label>Nombre del hecho
          <input id="caseName" placeholder="Se autocompleta con Carátula + Fecha + (PU)"/>
        </label>
        <div class="row" style="align-items:flex-end">
          <button class="btn" id="saveCase">Guardar nuevo</button>
          <button class="btn ghost" id="updateCase">Actualizar seleccionado</button>
          <button class="btn ghost" id="deleteCase">Borrar seleccionado</button>
        </div>
      </div>

      <div class="small" style="margin-top:6px">
        Seleccioná 1 (radio) para cargar/actualizar o varios (checkbox) para exportar.
      </div>

      <!-- Buscador -->
      <div class="row" style="gap:8px;align-items:center;margin-top:8px">
        <label class="small">Buscar</label>
        <input id="caseSearch" placeholder="Filtrar por nombre, fecha, PU, dependencia, etc." style="max-width:420px">
      </div>

      <div id="casesList" class="preview" style="max-height:220px;overflow:auto">Sin hechos guardados.</div>

      <div class="row" style="margin-top:10px">
        <button class="btn ghost" id="loadSelected">Cargar seleccionado</button>
        <button class="btn success" id="exportCSV">Exportar CSV (seleccionados)</button>
        <button class="btn success" id="downloadWordMulti">Descargar Word (seleccionados)</button>

        <!-- Respaldo / restauración -->
        <button class="btn ghost" id="backupJSON">Respaldar (JSON)</button>
        <button class="btn ghost" id="restoreJSON">Restaurar (JSON)</button>
        <button class="btn ghost" id="mergeJSON">Fusionar (JSON) directo</button>
        <input type="file" id="restoreFile" accept="application/json" style="display:none"/>
        <input type="file" id="mergeFile" accept="application/json" style="display:none"/>
      </div>
    </section>

    <!-- TABS -->
    <section class="card">
      <h2>1) Carga de datos</h2>

      <div class="tabs" data-tabs>
        <div class="tabs-nav">
          <button class="tab is-active" data-tab="t-generales">Datos generales</button>
          <button class="tab" data-tab="t-civiles">Civiles</button>
          <button class="tab" data-tab="t-fuerzas">Personal Fuerzas</button>
          <button class="tab" data-tab="t-objetos">Objetos</button>
          <button class="tab" data-tab="t-catalogos">Catálogos</button>
        </div>

        <!-- Generales -->
        <div class="tab-panel is-active" id="t-generales">
          <div class="grid">
            <label>Fecha <input type="date" id="g_fecha_dia"></label>

            <label>Tipo expediente
              <select id="g_tipoExp">
                <option value="PU" selected>PU</option>
                <option value="IPP">IPP</option>
                <option value="Otro">Otro</option>
              </select>
            </label>
            <label>Número <input id="g_numExp" placeholder="270840"></label>

            <label>Partido
              <select id="g_partido">
                <option value="">— Elegir —</option>
                <option>General Pueyrredon</option>
                <option>Balcarce</option>
                <option>Mar Chiquita</option>
                <option>General Alvarado</option>
              </select>
            </label>
            <label>Localidad
              <select id="g_localidad"></select>
            </label>
          </div>

          <div class="grid">
            <label>Dependencia
              <select id="g_dep">
                <option value="">— Elegir —</option>
                <option value="__manual__">Escribir manualmente…</option>
              </select>
            </label>
            <label id="g_dep_manual_wrap" style="display:none">Dependencia (manual)
              <input id="g_dep_manual" placeholder="Ej.: Subcomisaría Camet"/>
            </label>

            <label>Carátula <input id="g_car" placeholder="Robo agravado en poblado en banda y por el uso de arma de fuego"></label>
            <label>Subtítulo <input id="g_sub" placeholder="Entradera"></label>
          </div>

          <div class="grid">
            <label>Estado
              <select id="g_ok">
                <option value="no">No esclarecido (Rojo)</option>
                <option value="si">Esclarecido (Azul)</option>
              </select>
            </label>
            <label>UFI / Intervención <input id="g_ufi" placeholder="UFI 10 Dr. Pérez"></label>
            <label>Coordenadas <input id="g_coord" placeholder="-38.000, -57.555"></label>
            <label class="row" style="align-items:center;gap:10px">
              <input type="checkbox" id="g_relevante" /> <span>Relevante</span>
            </label>
            <label class="row" style="align-items:center;gap:10px">
              <input type="checkbox" id="g_supervisado" /> <span>Supervisado</span>
            </label>
          </div>

          <div class="title-preview">
            <div id="tituloCompuesto" class="titleline">—</div>
            <div id="subCompuesto" class="subtitleline">—</div>
          </div>
        </div>

        <!-- Civiles -->
        <div class="tab-panel" id="t-civiles">
          <div class="grid">
            <label>Nombre <input id="c_nombre"></label>
            <label>Apellido <input id="c_apellido"></label>
            <label>Edad <input id="c_edad"></label>
            <label>Género
              <select id="c_genero">
                <option value="">—</option><option>M</option><option>F</option><option>Otro</option>
              </select>
            </label>
            <label>DNI <input id="c_dni"></label>
            <label>País de origen <input id="c_pais"></label>
            <label>Localidad domicilio <input id="c_loc"></label>
            <label>Calle domicilio <input id="c_calle"></label>
            <label>Vínculo
              <select id="c_vinculo">
                <option>Victima</option>
                <option>Imputado</option>
                <option>Sindicado</option>
                <option>Denunciante</option>
                <option>Testigo</option>
                <option>PP</option>
                <option>Aprehendido</option>
                <option>Detenido</option>
                <option>Menor</option>
                <option>NN</option>
                <option>Damnificado institucional</option>
              </select>
            </label>
            <label>¿Óbito?
              <select id="c_obito"><option value="false">No</option><option value="true">Sí</option></select>
            </label>
          </div>
          <div class="row">
            <button class="btn" id="addCivil">Agregar involucrado</button>
          </div>
          <div id="civilesList" class="table"></div>
        </div>

        <!-- Fuerzas -->
        <div class="tab-panel" id="t-fuerzas">
          <div class="grid">
            <label>Nombre <input id="f_nombre"></label>
            <label>Apellido <input id="f_apellido"></label>
            <label>Edad <input id="f_edad"></label>
            <label>Fuerza <input id="f_fuerza" placeholder="Policía / Prefectura / etc."></label>
            <label>Legajo <input id="f_legajo"></label>
            <label>Jerarquía <input id="f_jerarquia"></label>
            <label>Destino <input id="f_destino"></label>
            <label>Localidad domicilio <input id="f_loc"></label>
            <label>Calle domicilio <input id="f_calle"></label>
            <label>Vínculo
              <select id="f_vinculo">
                <option>Imputado</option>
                <option>Sindicado</option>
                <option>Testigo</option>
                <option>Denunciante</option>
                <option>Victima</option>
                <option>PP</option>
              </select>
            </label>
            <label>¿Óbito?
              <select id="f_obito"><option value="false">No</option><option value="true">Sí</option></select>
            </label>
          </div>
          <div class="row">
            <button class="btn" id="addFuerza">Agregar personal</button>
          </div>
          <div id="fuerzasList" class="table"></div>
        </div>

        <!-- Objetos -->
        <div class="tab-panel" id="t-objetos">
          <div class="grid">
            <label>Descripción <input id="o_desc" placeholder="Celular iPhone 13, $ 2.000.000 y USD 20.000."></label>
            <label>Vínculo
              <select id="o_vinc">
                <option>Secuestro</option>
                <option>Sustraccion</option>
                <option>Hallazgo</option>
                <option>Otro</option>
              </select>
            </label>
          </div>
          <div class="row">
            <button class="btn danger" id="addObjeto">Agregar objeto</button>
          </div>
          <div id="objetosList" class="table"></div>
        </div>

        <!-- Catálogos -->
        <div class="tab-panel" id="t-catalogos">
          <p class="small">Editá los catálogos por Partido. Un ítem por línea. Guardá para aplicar en los desplegables.</p>
          <div class="grid">
            <label>Partido
              <select id="cat_partidoSel">
                <option>General Pueyrredon</option>
                <option>Balcarce</option>
                <option>Mar Chiquita</option>
                <option>General Alvarado</option>
              </select>
            </label>
          </div>
          <div class="grid">
            <label>Localidades (una por línea)
              <textarea id="cat_localidades" rows="8"></textarea>
            </label>
            <label>Dependencias (una por línea)
              <textarea id="cat_dependencias" rows="8"></textarea>
            </label>
          </div>
          <div class="row">
            <button class="btn" id="cat_guardar">Guardar catálogos del partido</button>
            <button class="btn ghost" id="cat_reset">Restaurar valores de ejemplo</button>
          </div>
        </div>

      </div>
    </section>

    <!-- Cuerpo -->
    <section class="card">
      <h2>2) Resumen / Cuerpo</h2>
      <textarea id="cuerpo" rows="10" placeholder="Redactá el cuerpo. Ej.: &#10;Fecha... entrevistan con #victima:0 ... sustrayendo #secuestro:0 ..."></textarea>
      <p class="hint">
        Estilos rápidos: <code>*negrita*</code>, <code>_itálica_</code> (se usa en objetos), <code>!subrayado!</code>.
      </p>
      <div id="tagHelper" class="chips"></div>
    </section>

    <!-- Salidas -->
    <section class="card">
      <h2>3) Salidas</h2>
      <div class="row">
        <button class="btn" id="generar">Generar vista previa</button>
        <button class="btn ghost" id="copiarWA">Copiar WhatsApp</button>
        <button class="btn success" id="descargarWord">Descargar Word</button>
        <button class="btn success" id="exportCSV1">Exportar CSV (este)</button>
        <button class="btn ghost" id="clearAll">Borrar todo (limpiar formulario)</button>
      </div>
      <h3>Vista previa HTML</h3>
      <div id="previewHtml" class="preview"></div>
    </section>
  </main>

  <footer class="foot"><span>Ctrl + Enter = Generar</span></footer>

  <script defer src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.min.js"></script>
  <script defer src="assets/formatter.js?v=10"></script>
  <script defer src="assets/tabs.js?v=10"></script>
  <script defer src="assets/app.js?v=10"></script>
</body>
</html>


